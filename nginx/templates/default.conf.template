# å®šä¹‰ä¸Šæ¸¸æœåŠ¡ï¼ˆå¯ä»¥åŠ å¤šä¸ª IP åšè´Ÿè½½å‡è¡¡ï¼‰
upstream tryon_server {
    server 127.0.0.1:${TRYON_PORT};
}

server {
    listen 80;

    client_max_body_size 100m;

    # # ä½¿ç”¨ XFF å¤´
    # real_ip_header X-Forwarded-For;
    # # é€’å½’è§£æ XFF ä¸­çš„æœ€åä¸€ä¸ª IP
    # real_ip_recursive on;

    location /composited/ {
        alias /app/composited/;
        autoindex on;                       # å¯ç”¨ç›®å½•æµè§ˆ
        autoindex_exact_size off;           # æ–‡ä»¶å¤§å°ä»¥KB/MBæ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰
        autoindex_localtime on;             # æ˜¾ç¤ºæœ¬åœ°æ—¶é—´ï¼ˆå¯é€‰ï¼‰
    }

    location / {
        proxy_pass http://tryon_server;

        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 600s;

        # WebSocket å…³é”® header è®¾ç½®
        proxy_http_version 1.1;

        # ğŸ‘‡ ä»…å½“è¯·æ±‚å¤´ä¸­æœ‰ Upgrade æ‰è®¾ç½®å‡çº§å¤´
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;

        # å¸¸è§„ header è®¾ç½®
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
